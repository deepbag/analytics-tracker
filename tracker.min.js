(()=>{let n={serverPeerId:"analytics-server",peerHost:"localhost",peerPort:9e3,peerPath:"/peerjs",batchInterval:5e3},o,r,t=[],s=()=>{(r=o.connect(n.serverPeerId,{reliable:!0})).on("open",()=>{console.log("[Analytics] Connected to server"),a()}),r.on("data",e=>{console.log("[Analytics] Server Response:",e)}),r.on("error",e=>console.error("[Analytics] Connection error:",e)),r.on("close",()=>{console.warn("[Analytics] Connection closed, retrying..."),setTimeout(s,3e3)})},c=(e,n={})=>{e={domain:window.location.hostname,url:window.location.href,timestamp:(new Date).toISOString(),referrer:document.referrer||null,eventType:e,properties:n};t.push(e),console.log("[Analytics] Queued:",e),r&&r.open&&a()},a=()=>{if(0!==t.length&&r&&r.open)try{r.send(JSON.stringify(t)),console.log("[Analytics] Sent:",t.length,"events"),t=[]}catch(e){console.error("[Analytics] Failed to send events:",e)}};setInterval(a,n.batchInterval),(async()=>{var e=await new Promise(e=>{var n=document.createElement("script");n.src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js",n.onload=()=>e(window.Peer),document.head.appendChild(n)});(o=new e(window.location.hostname.replace(/\./g,"_")||"unknown_"+Date.now(),{host:n.peerHost,port:n.peerPort,path:n.peerPath,debug:2})).on("open",()=>{console.log("[Analytics] Peer ID:",o.id),s()}),o.on("disconnected",()=>{console.warn("[Analytics] Disconnected, reconnecting..."),o.reconnect()}),o.on("error",e=>console.error("[Analytics] PeerJS error:",e))})().then(()=>c("pageview")),window.track=(e,n)=>c(e,n)})();