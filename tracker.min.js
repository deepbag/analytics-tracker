(()=>{let e={serverUrl:"ws://localhost:9000",batchInterval:5e3},t,o=[],s=null,i={},n=()=>{s?((t=new WebSocket(e.serverUrl)).onopen=()=>{console.log("[Analytics] Connected to server"),r()},t.onmessage=e=>{console.log("[Analytics] Server Response:",e.data)},t.onerror=e=>{console.error("[Analytics] WebSocket error:",e)},t.onclose=()=>{console.warn("[Analytics] Connection closed, retrying..."),setTimeout(n,3e3)}):console.warn("[Analytics] Website ID is required. Tracking is disabled.")},a=(e,n={})=>{s?(e={domain:window.location.hostname,url:window.location.href,timestamp:(new Date).toISOString(),referrer:document.referrer||null,eventType:e,properties:{...n,...i},websiteId:s},o.push(e),console.log("ðŸ“© Queued Event:",JSON.stringify(e)),t&&t.readyState===WebSocket.OPEN&&(console.log("ðŸš€ Sending event immediately..."),r())):console.warn("[Analytics] Website ID is required. Event tracking is disabled.")},r=()=>{if(s&&0!==o.length&&t&&t.readyState===WebSocket.OPEN)try{t.send(JSON.stringify(o)),console.log("[Analytics] Sent:",o.length,"events"),o=[]}catch(e){console.error("[Analytics] Failed to send events:",e)}};setInterval(r,e.batchInterval),window.track=(e,n)=>a(e,n),window.trackWebsiteSession=async e=>{e?(s=e,await(async()=>{try{var e=await(await fetch("https://ip-api.com/json")).json();i={country:e.country,region:e.regionName,city:e.city,lat:e.lat,lon:e.lon,timezone:e.timezone,isp:e.isp},console.log("[Analytics] Location fetched:",i)}catch(e){console.warn("[Analytics] Failed to fetch location:",e)}})(),n(),a("session_start",{websiteId:e}),window.addEventListener("beforeunload",()=>{a("session_stop",{websiteId:e}),r()}),document.addEventListener("visibilitychange",()=>{document.hidden&&(a("session_stop",{websiteId:e}),r())})):console.warn("[Analytics] Invalid website ID. Tracking is disabled.")}})();